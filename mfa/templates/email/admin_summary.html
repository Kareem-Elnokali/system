<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>{{ site_name }} • Security Summary</title>
    <style>
      body { margin:0; padding:0; background:#0b1220; }
      .wrap { width:100%; padding:28px 12px; background:#0b1220; }
      .card { width:100%; max-width:720px; margin:0 auto; background:#ffffff; border-radius:14px; border-collapse:separate; }
      .header { 
        background: linear-gradient(135deg, rgba(118,185,87,0.98) 0%, rgba(63,111,44,0.98) 100%);
        color:#ffffff; border-radius:14px 14px 0 0; 
      }
      .badge-hero { display:inline-block; background:rgba(255,255,255,.2); color:#ffffff; border:1px solid rgba(255,255,255,.35); padding:4px 10px; border-radius:999px; font-size:12px; font-weight:800; line-height:1; }
      .h-title { font-family: Arial, Helvetica, sans-serif; font-size:28px; font-weight:800; margin:0; color:#ffffff; }
      .h-sub { font-family: Arial, Helvetica, sans-serif; font-size:13px; margin:6px 0 0; color: rgba(255,255,255,.9); }
      .inner { padding:22px 24px; font-family: Arial, Helvetica, sans-serif; color:#0f172a; font-size:14px; line-height:1.6; }
      .kpi-title { margin:0; color:#64748b; font-size:11px; text-transform:uppercase; letter-spacing:.06em; font-weight:800; }
      .kpi-value { margin:6px 0 8px; font-size:28px; font-weight:900; color:#0b1220; }
      .badge { display:inline-block; padding:4px 10px; border-radius:999px; font-size:11px; font-weight:700; color:#0b1220; background:#e8efff; border:1px solid #dbe7ff; line-height:1; vertical-align:middle; }
      .badge-wrap { display:block; height:auto; min-height:26px; line-height:1; white-space:nowrap; overflow:visible; padding:4px 0; }
      .kpi-title-wrap { min-height:28px; }
      .kpi-box { background:#f8fbff; border:1px solid #e8eef8; border-radius:12px; padding:14px 14px; }
      .kpi-box td { height:122px; vertical-align: top; }
      .spacer-vert { height:12px; line-height:12px; font-size:0; }
      .cta { text-align:center; padding-top:8px; }
      .btn { display:inline-block; background:#55833d; color:#ffffff !important; padding:12px 18px; border-radius:10px; font-weight:800; text-decoration:none; font-family: Arial, Helvetica, sans-serif; }
      .footer { background:#f8fafc; border-top:1px solid #eef2f7; color:#475569; font-family: Arial, Helvetica, sans-serif; font-size:12px; border-radius:0 0 14px 14px; }
      .chart-wrap { margin-top:14px; border:1px solid #e8eef8; border-radius:12px; padding:12px; background:#ffffff; }
      .chart-title { font-weight:800; font-size:14px; color:#0b1220; margin:0 0 6px; }
      .legend { font-size:12px; color:#64748b; }
      .legend-dot { display:inline-block; width:10px; height:10px; border-radius:999px; margin-right:6px; vertical-align:middle; }
      .dot-success { background:#22c55e; }
      .dot-failure { background:#ef4444; }
      .bars { width:100%; table-layout:fixed; }
      .bar-col { width:14.28%; text-align:center; }
      .bar { width:20px; margin:0 auto; border-radius:6px; background:#e2e8f0; height:120px; position:relative; }
      .seg { position:absolute; left:0; right:0; text-align:center; color:#ffffff; font-weight:800; font-size:11px; line-height:1; display:flex; align-items:center; justify-content:center; padding:0 2px; }
      .seg-success { background:#22c55e; border-top-left-radius:6px; border-top-right-radius:6px; }
      .seg-failure { background:#ef4444; border-bottom-left-radius:0; border-bottom-right-radius:0; }
      .bar-label { font-size:11px; color:#64748b; padding-top:6px; word-break:break-word; }
      @media (max-width:480px){
        .bar { height:100px; width:18px; }
        .bar-col { width:14.28%; }
        .kpi-box td { height:144px; }
        .kpi-title { font-size:10px; }
        .kpi-value { font-size:26px; }
        .badge { font-size:10px; padding:4px 8px; }
        .badge-wrap { min-height:26px; padding:4px 0; }
      }
</style>
  </head>
  <body>
    <table role="presentation" cellpadding="0" cellspacing="0" border="0" width="100%" class="wrap">
      <tr>
        <td align="center">
          <table role="presentation" cellpadding="0" cellspacing="0" border="0" class="card">
            <tr>
              <td class="header" style="padding:24px 24px;">
                <div>
                  <span class="badge-hero">Admin</span>
                </div>
                <div class="h-title" style="margin-top:8px;">Security Center — {{ site_name }}</div>
                <div class="h-sub">Concise KPIs to keep your team in the loop</div>
              </td>
            </tr>
            <tr>
              <td class="inner">
                <table role="presentation" cellpadding="0" cellspacing="0" border="0" width="100%">
                  <tr>
                    <td width="33.33%" style="padding:6px;">
                      <table role="presentation" width="100%" cellpadding="0" cellspacing="0" border="0" class="kpi-box">
                        <tr><td>
                          <div class="kpi-title-wrap"><div class="kpi-title">Total users</div></div>
                          <div class="kpi-value">{{ stats.total_users }}</div>
                          <div class="badge-wrap"><span class="badge">Users</span></div>
                         </td></tr>
                      </table>
                    </td>
                    <td width="33.33%" style="padding:6px;">
                      <table role="presentation" width="100%" cellpadding="0" cellspacing="0" border="0" class="kpi-box">
                        <tr><td>
                          <div class="kpi-title-wrap"><div class="kpi-title">MFA enabled (TOTP)</div></div>
                          <div class="kpi-value">{{ stats.users_with_totp }}</div>
                          <div class="badge-wrap"><span class="badge">Security Coverage</span></div>
                          </td></tr>
                      </table>
                    </td>
                    <td width="33.33%" style="padding:6px;">
                      <table role="presentation" width="100%" cellpadding="0" cellspacing="0" border="0" class="kpi-box">
                        <tr><td>
                          <div class="kpi-title-wrap"><div class="kpi-title">Failed attempts (24h)</div></div>
                          <div class="kpi-value">{{ stats.failed_attempts_24h }}</div>
                          <div class="badge-wrap"><span class="badge" style="background:#fef3c7; border-color:#fde68a; color:#92400e;">Risk Signals</span></div>
                          </td></tr>
                      </table>
                    </td>
                  </tr>
                  <tr>
                    <td width="33.33%" style="padding:6px;">
                      <table role="presentation" width="100%" cellpadding="0" cellspacing="0" border="0" class="kpi-box">
                        <tr><td>
                          <div class="kpi-title-wrap"><div class="kpi-title">Superadmins</div></div>
                          <div class="kpi-value">{{ stats.superusers_count }}</div>
                          <div class="badge-wrap"><span class="badge">Privileged</span></div>
                          </td></tr>
                      </table>
                    </td>
                    <td width="33.33%" style="padding:6px;">
                      <table role="presentation" width="100%" cellpadding="0" cellspacing="0" border="0" class="kpi-box">
                        <tr><td>
                          <div class="kpi-title-wrap"><div class="kpi-title">Successes (24h)</div></div>
                          <div class="kpi-value">{{ stats.successes_24h }}</div>
                          <div class="badge-wrap"><span class="badge" style="background:#dcfce7; border-color:#bbf7d0; color:#166534;">Auth Volume</span></div>
                          </td></tr>
                      </table>
                    </td>
                    <td width="33.33%" style="padding:6px;">
                      <table role="presentation" width="100%" cellpadding="0" cellspacing="0" border="0" class="kpi-box">
                        <tr><td>
                          <div class="kpi-title-wrap"><div class="kpi-title">MFA adoption rate (%)</div></div>
                          <div class="kpi-value">{{ stats.mfa_adoption_rate_pct }}%</div>
                          <div class="badge-wrap"><span class="badge">Adoption</span></div>
                          </td></tr>
                      </table>
                    </td>
                  </tr>
                </table>
                <div style="margin: 20px 0; padding: 16px; border: 1px solid #e2e8f0; border-radius: 10px; background: #ffffff; box-shadow: 0 1px 2px rgba(16,24,40,.06);">
                  <h3 style="margin: 0 0 12px 0; color: #1e293b; font-size: 16px; font-weight: 700;">7-Day Authentication Outcomes</h3>
                  <table role="presentation" cellpadding="0" cellspacing="0" border="0" width="100%" style="margin-bottom:10px;">
                    <tr>
                      <td>
                        <span style="display:inline-block;background:#eef2ff;color:#3730a3;border:1px solid #e0e7ff;border-radius:999px;padding:6px 10px;margin-right:6px;font-size:12px;font-weight:700;">Total: {{ week_success_total|default:0|add:week_failure_total|default_if_none:0 }}</span>
                        <span style="display:inline-block;background:#ecfdf5;color:#065f46;border:1px solid #a7f3d0;border-radius:999px;padding:6px 10px;margin-right:6px;font-size:12px;font-weight:700;">
                          Successes: {{ week_success_total|default:0 }}
                        </span>
                        <span style="display:inline-block;background:#fef2f2;color:#991b1b;border:1px solid #fecaca;border-radius:999px;padding:6px 10px;margin-right:6px;font-size:12px;font-weight:700;">
                          Failures: {{ week_failure_total|default:0 }}
                        </span>
                      </td>
                      <td align="right" style="white-space:nowrap;"></td>
                    </tr>
                  </table>
                  <div style="font-size:12px; color:#64748b; margin-bottom:8px;">
                    <span style="display:inline-block; width:10px; height:10px; border-radius:999px; background:#22c55e; vertical-align:middle; margin-right:6px;"></span>Successes
                    &nbsp;&nbsp;
                    <span style="display:inline-block; width:10px; height:10px; border-radius:999px; background:#ef4444; vertical-align:middle; margin-right:6px;"></span>Failures
                  </div>
                  <table role="presentation" cellpadding="0" cellspacing="0" border="0" width="100%">
                    <tr>
                      <td align="center" style="padding:6px 0;">
                        {% if donut_cid %}
                          <img src="cid:{{ donut_cid }}" alt="Success vs Failure (7d)" width="176" height="176" style="display:block; width:176px; height:176px; margin:0 auto;"/>
                        {% else %}
                          <div style="color:#64748b; font-size:14px;">No chart available.</div>
                        {% endif %}
                      </td>
                    </tr>
                    <tr>
                      <td align="center" style="padding-top:8px; font-family:Arial, Helvetica, sans-serif; font-size:13px; color:#334155;">
                        <span style="display:inline-block; margin-right:14px;"><span style="display:inline-block;width:8px;height:8px;border-radius:999px;background:#22c55e;vertical-align:middle;margin-right:6px;"></span>{{ total_success_7d|default:0 }} Successes</span>
                        <span style="display:inline-block;"><span style="display:inline-block;width:8px;height:8px;border-radius:999px;background:#ef4444;vertical-align:middle;margin-right:6px;"></span>{{ total_failure_7d|default:0 }} Failures</span>
                      </td>
                    </tr>
                  </table>
                </div>
                <div class="cta">
                  <a class="btn" href="{{ dashboard_url }}">Open Security Center</a>
                </div>
              </td>
            </tr>
            <tr>
              <td class="footer" style="padding:14px 24px;">
                <div>Generated at {{ generated_at|date:"Y-m-d H:i" }}.</div>
                <div style="color:#64748b;">To change recipients or frequency, visit Admin → Report Settings.</div>
              </td>
            </tr>
          </table>
        </td>
      </tr>
    </table>
  </body>
  </html>