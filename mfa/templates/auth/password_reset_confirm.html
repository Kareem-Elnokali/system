{% extends 'mfa/base.html' %}
{% load static %}
{% load widget_tweaks %}
{% block title %}Set New Password - {{ site_name }}{% endblock %}
{% block content %}
    {% include 'partials/navbar.html' %}
    <div class="container py-5">
      <div class="row justify-content-center">
        <div class="col-md-7 col-lg-5">
          <div class="card border shadow-lg p-4">
            <h2 class="h2Title mb-2 text-center"><span class="brand-color">S</span>et a new password</h2>
            <p class="text-muted text-center mb-3">Please enter your new password below.</p>
          <div class="password-requirements mb-3" style="font-size: 0.9rem; color: #555;">
            <p class="mb-1">Your password must:</p>
            <ul class="list-unstyled ps-3">
              <li>- Be at least 8 characters long.</li>
              <li>- Not be a common password.</li>
              <li>- Not be entirely numeric.</li>
              <li>- Not be too similar to your personal information.</li>
            </ul>
          </div>
            {% if validlink %}
            <form method="post" novalidate>
              {% csrf_token %}
              {{ form.non_field_errors }}
              {% for field in form %}
              <div class="mb-3">
                <label for="{{ field.id_for_label }}">{{ field.label }}</label>
                <div class="input-group">
                  <div class="input-group-prepend">
                    <span class="input-group-text" aria-hidden="true"><i class="fa fa-lock"></i></span>
                  </div>
                  {% if field.errors %}
                    {{ field|add_class:'form-control is-invalid'|attr:'autocomplete:new-password'|attr:'placeholder:'|attr:'aria-describedby:' }}
                  {% else %}
                    {{ field|add_class:'form-control'|attr:'autocomplete:new-password'|attr:'placeholder:'|attr:'aria-describedby:' }}
                  {% endif %}
                </div>
                {% if field.errors %}
                  <div class="invalid-feedback d-block">{{ field.errors|striptags }}</div>
                {% endif %}
              </div>
              {% endfor %}
              <button type="submit" class="submitButton w-100">Update Password</button>
            </form>
            {% else %}
              <div class="text-center">
                <p class="mb-2">This password reset link is invalid or has expired.</p>
                <a class="brand-link" href="{% url 'mfa:password_reset' %}">Request a new reset link</a>
              </div>
            {% endif %}
            <div class="auth-helper text-center mt-3">
              <p class="mb-0 small"><a class="brand-link" href="{% url 'mfa:login' %}">Back to Login</a></p>
            </div>
          </div>
        </div>
      </div>
    </div>
    {% include 'partials/footer.html' %}
    <script>
      (function(){
        var inputs = document.querySelectorAll('input[type="password"], input[type="text"]');
        inputs.forEach(function(i){
          i.classList.add('form-control');
          if (i.type === 'password') {
            var n = (i.getAttribute('name') || '').toLowerCase();
            if (n.includes('new_password1') || n.includes('password1')) {
              i.setAttribute('placeholder', 'Create a new password');
              i.setAttribute('autocomplete', 'new-password');
            } else if (n.includes('new_password2') || n.includes('password2')) {
              i.setAttribute('placeholder', 'Confirm new password');
              i.setAttribute('autocomplete', 'new-password');
            } else {
              i.setAttribute('placeholder', 'Password');
            }
          }
        });
      })();
</script>
{% endblock %}
